## はじめに

認証機能付きダッシュボードアプリケーションの開発環境を構築します。Next.jsプロジェクトの作成からSupabase CLIを使用したローカル開発環境のセットアップまで、認証機能の実装に必要な基盤を整えます。

## 目的

認証機能付きダッシュボードアプリケーションの開発に必要な基盤環境を構築し、Next.jsプロジェクトの作成からSupabase CLIを使用したローカル開発環境のセットアップまで完了させます。

## 学習対象のスキル

- Next.jsプロジェクトの作成
- Supabase CLIの使用
- ローカル開発環境の構築
- 環境変数の管理
- 開発サーバーの起動

## 前提環境

- Node.js LTS（18.0以上推奨）
- npmまたはyarn
- ブラウザ（Chrome、Firefox、Safari等）
- Docker（Supabaseローカル環境用）

## 新規プロジェクトの作成

ターミナルで以下のコマンドを実行し、Next.jsプロジェクトを作成します。

```bash
npx create-next-app@latest lesson4-auth --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --yes
```

プロジェクト作成後、作成されたディレクトリに移動します。

```bash
cd lesson4-auth
```

## 依存関係の追加

Supabaseの認証機能に必要なパッケージをインストールします。

```bash
npm install @supabase/supabase-js @supabase/ssr
```

## Supabase CLIのインストール

Supabase CLIをインストールしてローカル開発環境を構築します。

```bash
npm install -g supabase
```

## Supabaseローカル環境の初期化

プロジェクトルートでSupabaseを初期化します。

```bash
npx supabase init
```

## Supabaseローカル環境の起動

Dockerを使用してローカルSupabase環境を起動します。

```bash
npx supabase start
```

起動が完了すると、以下のような情報が表示されます：

```
         API URL: http://127.0.0.1:54321
     GraphQL URL: http://127.0.0.1:54321/graphql/v1
  S3 Storage URL: http://127.0.0.1:54321/storage/v1/s3
          DB URL: postgresql://postgres:postgres@127.0.0.1:54322/postgres
      Studio URL: http://127.0.0.1:54323
    Inbucket URL: http://127.0.0.1:54324
      JWT secret: super-secret-jwt-token-with-at-least-32-characters-long
        anon key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
service_role key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## 環境変数の設定

プロジェクトルートに`.env.local`ファイルを作成し、以下の内容を記述します。

```env
NEXT_PUBLIC_SUPABASE_URL=http://127.0.0.1:54321
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

上記の`anon key`の部分を、`npx supabase start`で表示された実際のキーに置き換えてください。

## 動作確認

開発サーバーを起動して、プロジェクトが正常に動作することを確認します。

```bash
npm run dev
```

ブラウザで`http://localhost:3000`にアクセスし、Next.jsのデフォルトページが表示されることを確認します。

## Supabase Studioの確認

ローカルSupabase Studioにアクセスして、データベースの状態を確認できます。

ブラウザで`http://127.0.0.1:54323`にアクセスし、Supabase Studioが表示されることを確認します。

## 章末の確認

- 開発サーバーが正常に起動する
- ブラウザでトップページが表示される
- 環境変数が正しく設定されている
- Supabaseローカル環境が起動している
- Supabase Studioにアクセスできる
- エラーメッセージ設定ファイル（`src/config/error-messages.json`）が存在する
