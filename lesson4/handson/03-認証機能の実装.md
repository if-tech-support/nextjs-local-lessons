## はじめに

Supabase Authenticationを使用した認証機能を実装します。型定義、Server Actions、ログインページを作成し、メール+パスワードでのサインアップとログイン機能を構築します。

## 目的

- 認証関連の型定義の作成
- Supabaseクライアントの設定
- Server Actionsによる認証処理の実装
- ログインページの作成

## 学習対象のスキル

- TypeScriptの型定義
- Supabase Authentication API
- Server Actionsの実装
- フォーム処理とエラーハンドリング

## 課題A：型定義の作成（5分）

5分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

認証機能で使用する型定義を作成します。

- 作成するファイル: `src/types/auth.ts`
- 認証フォームデータ: メールアドレスとパスワードの文字列
- 認証エラー: エラーメッセージの文字列
- ユーザー情報: IDとメールアドレスの文字列

【使用タグ】
- `interface`（型定義）
  - `AuthFormData`
  - `AuthError`
  - `User`

### ヒント

- TypeScriptの`interface`を使用
- 各プロパティの型を明示的に指定

### 解答例

```typescript
export interface AuthFormData {
  email: string;
  password: string;
}

export interface AuthError {
  message: string;
}

export interface User {
  id: string;
  email: string;
}
```

## 課題B：Supabaseクライアントの設定（8分）

8分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

サーバーサイドで使用するSupabaseクライアントを作成します。

- 作成するファイル: `src/lib/supabase/server.ts`
- 環境変数: `NEXT_PUBLIC_SUPABASE_URL`と`NEXT_PUBLIC_SUPABASE_ANON_KEY`を使用
- cookies管理: `next/headers`の`cookies`を使用
- エラーハンドリング: `setAll`でエラーが発生した場合は無視

【使用タグ】
- `createServerClient`（Supabaseクライアント作成）
- `cookies`（Next.jsのcookies管理）

### ヒント

- `@supabase/ssr`の`createServerClient`を使用
- cookiesの`getAll`と`setAll`メソッドを実装
- 環境変数は`process.env`から取得

### 解答例

```typescript
import { createServerClient } from "@supabase/ssr";
import { cookies } from "next/headers";

export async function createClient() {
  const cookieStore = await cookies();

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll();
        },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options)
            );
          } catch {
            // The `setAll` method was called from a Server Component.
            // This can be ignored if you have middleware refreshing
            // user sessions.
          }
        },
      },
    }
  );
}
```

## 課題C：クライアント用Supabaseクライアントの作成（5分）

5分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

ブラウザ環境で使用するSupabaseクライアントを作成します。

- 作成するファイル: `src/lib/supabase/client.ts`
- ブラウザクライアント: `createBrowserClient`を使用
- 環境変数: `NEXT_PUBLIC_SUPABASE_URL`と`NEXT_PUBLIC_SUPABASE_ANON_KEY`
- エクスポート: `createClient`関数

【使用タグ】
- `createBrowserClient`（ブラウザ用クライアント）
- `process.env`（環境変数）

### ヒント

- `@supabase/ssr`の`createBrowserClient`を使用
- 環境変数は`NEXT_PUBLIC_`プレフィックスが必要
- 関数をエクスポートして他のコンポーネントで使用

### 解答例

```typescript
import { createBrowserClient } from "@supabase/ssr";

export function createClient() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );
}
```

## 課題D：Server Actionsの実装（10分）

10分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

認証処理を行うServer Actionsを作成します。

- 作成するファイル: `src/lib/actions.ts`
- サインアップ機能: メールとパスワードで新規登録
- ログイン機能: メールとパスワードでログイン
- ログアウト機能: セッションを終了
- エラーハンドリング: 日本語翻訳されたエラーメッセージを返却
- リダイレクト: 成功時に適切なページへ遷移
- Client Component対応: `signInAction`と`signUpAction`を追加

【使用タグ】
- `signUp`（サインアップ関数）
- `signIn`（ログイン関数）
- `signOut`（ログアウト関数）
- `signInAction`（Client Component用ログイン関数）
- `signUpAction`（Client Component用サインアップ関数）

### ヒント

- `"use server"`ディレクティブを追加
- `revalidatePath`でキャッシュを更新
- `redirect`でページ遷移
- エラー時は`translateErrorMessage`で日本語翻訳
- Client Component用のAction関数を追加

### 解答例

```typescript
"use server";

import { revalidatePath } from "next/cache";
import { redirect } from "next/navigation";
import { createClient } from "@/lib/supabase/server";
import { AuthFormData, AuthError } from "@/types/auth";
import { translateErrorMessage } from "@/lib/error-messages";

export async function signUp(
  formData: AuthFormData
): Promise<AuthError | null> {
  const supabase = await createClient();

  const { error } = await supabase.auth.signUp({
    email: formData.email,
    password: formData.password,
  });

  if (error) {
    return { message: translateErrorMessage(error.message) };
  }

  revalidatePath("/", "layout");
  redirect("/dashboard");
}

export async function signIn(
  formData: AuthFormData
): Promise<AuthError | null> {
  const supabase = await createClient();

  const { error } = await supabase.auth.signInWithPassword({
    email: formData.email,
    password: formData.password,
  });

  if (error) {
    return { message: translateErrorMessage(error.message) };
  }

  revalidatePath("/", "layout");
  redirect("/dashboard");
}

export async function signUpAction(
  formData: FormData
): Promise<AuthError | null> {
  const data: AuthFormData = {
    email: formData.get("email") as string,
    password: formData.get("password") as string,
  };

  return await signUp(data);
}

export async function signInAction(
  formData: FormData
): Promise<AuthError | null> {
  const data: AuthFormData = {
    email: formData.get("email") as string,
    password: formData.get("password") as string,
  };

  return await signIn(data);
}

export async function signOut() {
  const supabase = await createClient();

  await supabase.auth.signOut();

  revalidatePath("/", "layout");
  redirect("/");
}
```

## 課題E：エラーメッセージ管理システムの実装（7分）

7分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

設定ファイルベースのエラーメッセージ管理システムを作成します。

- 作成するファイル: `src/config/error-messages.json`
- 作成するファイル: `src/lib/error-messages.ts`
- 設定ファイル: JSON形式でエラーメッセージの翻訳を管理（Node.js標準）
- 翻訳関数: 完全一致と部分一致でエラーメッセージを翻訳
- キャッシュ機能: ファイル変更検知による効率的な読み込み
- フォールバック: 設定ファイル読み込み失敗時のデフォルトメッセージ

#### 動作仕様
- 完全一致でエラーメッセージを検索します
- 完全一致しない場合は、部分一致で検索します
- 翻訳が見つからない場合は、元のメッセージをそのまま返します
- 設定ファイルはキャッシュされ、ファイルが変更された場合のみ再読み込みされます

#### 注意事項
- JSONファイルの構文エラーがある場合、デフォルトのメッセージが使用されます
- 設定ファイルの変更は、アプリケーションの再起動なしで反映されます
- キー名は英語のエラーメッセージと完全に一致させる必要があります

【使用タグ】
- `fs`（ファイルシステム操作）
- `path`（パス操作）
- `JSON.parse`（JSON解析）
- `Object.entries`（オブジェクト操作）

### ヒント

- 設定ファイルは`src/config/`ディレクトリに配置
- キャッシュ機能でパフォーマンスを最適化
- エラーハンドリングで堅牢性を確保
- 型安全性のためにTypeScriptインターフェースを定義

#### 設定方法
- **新しいエラーメッセージを追加**: `error-messages.json`ファイルを編集
- **既存のメッセージを変更**: 既存のキーの値を変更
- **メッセージの削除**: 不要になったメッセージはJSONファイルからキーと値を削除

### 解答例

```json
// src/config/error-messages.json
{
  "error_messages": {
    "Invalid login credentials": "メールアドレスまたはパスワードが正しくありません",
    "User not found": "ユーザーが見つかりません",
    "Email not confirmed": "メールアドレスが確認されていません",
    "Password should be at least": "パスワードは6文字以上で入力してください",
    "User already registered": "このメールアドレスは既に登録されています",
    "Invalid email": "有効なメールアドレスを入力してください",
    "Signup is disabled": "新規登録は現在無効になっています",
    "Email rate limit exceeded": "メール送信回数が上限に達しました。しばらく待ってから再試行してください"
  }
}
```

```typescript
// src/lib/error-messages.ts
import fs from "fs";
import path from "path";

interface ErrorMessages {
  error_messages: Record<string, string>;
}

let cachedErrorMessages: Record<string, string> | null = null;
let lastModified: number | null = null;

function loadErrorMessages(): Record<string, string> {
  try {
    const configPath = path.join(
      process.cwd(),
      "src",
      "config",
      "error-messages.json"
    );
    const stats = fs.statSync(configPath);
    const currentModified = stats.mtime.getTime();

    if (cachedErrorMessages && lastModified === currentModified) {
      return cachedErrorMessages;
    }

    const fileContents = fs.readFileSync(configPath, "utf8");
    const config = JSON.parse(fileContents) as ErrorMessages;

    cachedErrorMessages = config.error_messages;
    lastModified = currentModified;

    return config.error_messages;
  } catch (error) {
    console.error("エラーメッセージ設定の読み込みに失敗しました:", error);

    if (cachedErrorMessages) {
      return cachedErrorMessages;
    }

    return {
      "Invalid login credentials": "メールアドレスまたはパスワードが正しくありません",
      "User not found": "ユーザーが見つかりません",
      "Email not confirmed": "メールアドレスが確認されていません",
      "Password should be at least": "パスワードは6文字以上で入力してください",
      "User already registered": "このメールアドレスは既に登録されています",
      "Invalid email": "有効なメールアドレスを入力してください",
      "Signup is disabled": "新規登録は現在無効になっています",
      "Email rate limit exceeded": "メール送信回数が上限に達しました。しばらく待ってから再試行してください",
    };
  }
}

export function translateErrorMessage(message: string): string {
  const errorMessages = loadErrorMessages();

  if (errorMessages[message]) {
    return errorMessages[message];
  }

  for (const [key, translation] of Object.entries(errorMessages)) {
    if (message.includes(key)) {
      return translation;
    }
  }

  return message;
}

export function getAvailableErrorMessages(): Record<string, string> {
  return loadErrorMessages();
}
```

## 課題F：ログインページの作成（8分）

8分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

ログインとサインアップのフォームを持つページを作成します。

- 作成するファイル: `src/app/login/page.tsx`
- ページタイトル: 「アカウントにログイン」
- フォーム要素: メールアドレスとパスワードの入力フィールド
- ボタン: 「ログイン」と「サインアップ」の2つ
- レイアウト: 中央揃え、最大幅`max-w-md`
- バリデーション: 必須入力、メール形式
- エラーハンドリング: エラーメッセージの表示とローディング状態

【使用タグ】
- `div`（最上位コンテナー）
  - `div`（フォームラッパー）
    - `div`（ヘッダー）
      - `h2`（ページタイトル）
      - `p`（説明文）
    - `div`（エラーメッセージ）
    - `form`（フォーム）
      - `div`（入力フィールド）
        - `input`（メール入力）
        - `input`（パスワード入力）
      - `div`（ボタンエリア）
        - `button`（ログインボタン）
        - `button`（サインアップボタン）

### ヒント

- Tailwindの例：`min-h-screen` `flex` `items-center` `justify-center` `max-w-md` `space-y-8`
- `useState`でエラー状態とローディング状態を管理
- `useRouter`で成功時のリダイレクトを処理
- エラーメッセージは赤い背景で表示

### 解答例

```tsx
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import { signInAction, signUpAction } from "@/lib/actions";
import { AuthFormData } from "@/types/auth";

export default function LoginPage() {
  const [error, setError] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const router = useRouter();

  async function handleSignIn(formData: FormData) {
    setIsLoading(true);
    setError(null);

    const result = await signInAction(formData);
    if (result) {
      setError(result.message);
    } else {
      router.push("/dashboard");
    }
    setIsLoading(false);
  }

  async function handleSignUp(formData: FormData) {
    setIsLoading(true);
    setError(null);

    const result = await signUpAction(formData);
    if (result) {
      setError(result.message);
    } else {
      router.push("/dashboard");
    }
    setIsLoading(false);
  }

  return (
    <div className="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 bg-gray-50">
      <div className="max-w-md w-full space-y-8 bg-white p-8 rounded-lg shadow-md">
        <div>
          <h2 className="mt-6 text-center text-3xl font-extrabold text-gray-900">
            アカウントにログイン
          </h2>
          <p className="mt-2 text-center text-sm text-gray-600">
            または新しいアカウントを作成
          </p>
        </div>
        
        {error && (
          <div className="bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-md text-sm">
            {error}
          </div>
        )}
        
        <form className="mt-8 space-y-6">
          <div className="rounded-md shadow-sm -space-y-px">
            <div>
              <label htmlFor="email" className="sr-only">
                メールアドレス
              </label>
              <input
                id="email"
                name="email"
                type="email"
                autoComplete="email"
                required
                className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm"
                placeholder="メールアドレス"
              />
            </div>
            <div>
              <label htmlFor="password" className="sr-only">
                パスワード
              </label>
              <input
                id="password"
                name="password"
                type="password"
                autoComplete="current-password"
                required
                className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm"
                placeholder="パスワード"
              />
            </div>
          </div>

          <div className="flex space-x-4">
            <button
              formAction={handleSignIn}
              type="submit"
              disabled={isLoading}
              className="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {isLoading ? "処理中..." : "ログイン"}
            </button>
            <button
              formAction={handleSignUp}
              type="submit"
              disabled={isLoading}
              className="group relative w-full flex justify-center py-2 px-4 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {isLoading ? "処理中..." : "サインアップ"}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}
```

## 課題G：ログインページでの認証チェック機能（6分）

6分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

ログインページで認証状態をチェックし、ログイン済みユーザーを自動リダイレクトします。

- 編集するファイル: `src/app/login/page.tsx`
- 認証チェック: `useEffect`でページ読み込み時に実行
- ログイン済みの場合: ルート（`/`）に自動リダイレクト
- ローディング状態: 認証チェック中はスピナー表示
- クライアントクライアント: `createClient`を使用
- ナビゲーション: サインアップページへの下線付きリンクを追加

【使用タグ】
- `useEffect`（副作用フック）
- `useState`（状態管理）
- `createClient`（クライアント用Supabaseクライアント）
- `Link`（Next.jsリンクコンポーネント）

### ヒント

- `useEffect`でコンポーネントマウント時に認証状態をチェック
- ログイン済みの場合は`router.push("/")`でリダイレクト
- ローディング状態は`isCheckingAuth`で管理
- サインアップページへの下線付きリンクを追加

### 解答例

```tsx
"use client";

import { useState, useEffect } from "react";
import { useRouter } from "next/navigation";
import Link from "next/link";
import { signInAction } from "@/lib/actions";
import { createClient } from "@/lib/supabase/client";

export default function LoginPage() {
  const [error, setError] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [isCheckingAuth, setIsCheckingAuth] = useState(true);
  const router = useRouter();

  // ログイン状態をチェック
  useEffect(() => {
    const checkAuth = async () => {
      const supabase = createClient();
      const {
        data: { user },
      } = await supabase.auth.getUser();

      if (user) {
        // ログイン済みの場合はルートにリダイレクト
        router.push("/");
        return;
      }

      setIsCheckingAuth(false);
    };

    checkAuth();
  }, [router]);

  async function handleSignIn(formData: FormData) {
    setIsLoading(true);
    setError(null);

    try {
      const result = await signInAction(formData);
      if (result) {
        setError(result.message);
      }
      // 成功時はServer Actionでredirectされるため、ここでは何もしない
    } catch (error) {
      setError("ログインに失敗しました");
    } finally {
      setIsLoading(false);
    }
  }

  // 認証チェック中はローディング表示
  if (isCheckingAuth) {
    return (
      <div className="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 bg-gray-50">
        <div className="text-center">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
          <p className="mt-2 text-gray-600">認証状態を確認中...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 bg-gray-50">
      <div className="max-w-md w-full space-y-8 bg-white p-8 rounded-lg shadow-md">
        <div>
          <h2 className="mt-6 text-center text-3xl font-extrabold text-gray-900">
            アカウントにログイン
          </h2>
          <p className="mt-2 text-center text-sm text-gray-600">
            アカウントをお持ちでない場合は
            <Link
              href="/signup"
              className="font-medium text-blue-600 hover:text-blue-500 underline"
            >
              新規登録
            </Link>
            してください
          </p>
        </div>
        {error && (
          <div className="bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-md text-sm">
            {error}
          </div>
        )}

        <form className="mt-8 space-y-6" action={handleSignIn}>
          <div className="rounded-md shadow-sm -space-y-px">
            <div>
              <label htmlFor="email" className="sr-only">
                メールアドレス
              </label>
              <input
                id="email"
                name="email"
                type="email"
                autoComplete="email"
                required
                className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm"
                placeholder="メールアドレス"
              />
            </div>
            <div>
              <label htmlFor="password" className="sr-only">
                パスワード
              </label>
              <input
                id="password"
                name="password"
                type="password"
                autoComplete="current-password"
                required
                className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm"
                placeholder="パスワード"
              />
            </div>
          </div>

          <div>
            <button
              type="submit"
              disabled={isLoading}
              className="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {isLoading ? "処理中..." : "ログイン"}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}
```

## 課題H：サインアップページの作成（8分）

8分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

新規アカウント作成専用のサインアップページを作成します。

- 作成するファイル: `src/app/signup/page.tsx`
- 認証チェック: ログイン済みユーザーは自動リダイレクト
- フォーム: メールアドレスとパスワード入力
- ナビゲーション: ログインページへの下線付きリンク
- ボタン色: 緑色（`bg-green-600`）で統一

【命名】
- `SignupPage`（コンポーネント名）
- `error`（エラー状態）
- `isLoading`（ローディング状態）
- `isCheckingAuth`（認証チェック状態）
- `handleSignUp`（フォーム送信ハンドラー）
- `checkAuth`（認証チェック関数）

【参照】
- `useState`（React状態管理）
- `useEffect`（React副作用）
- `useRouter`（Next.jsルーター）
- `Link`（Next.jsリンク）
- `signUpAction`（Server Action）
- `createClient`（Supabaseクライアント）

【使用タグ】
- `div`（最上位コンテナー）
  - `div`（フォームラッパー）
    - `div`（ヘッダー）
      - `h2`（ページタイトル）
      - `p`（説明文）
        - `Link`（ログインページへのリンク）
    - `div`（エラーメッセージ）
    - `form`（フォーム）
      - `div`（入力フィールド）
        - `input`（メール入力）
        - `input`（パスワード入力）
      - `div`（ボタンエリア）
        - `button`（アカウント作成ボタン）

### ヒント

- ログインページと同様の構造で作成
- ボタンは緑色で「アカウント作成」テキスト
- ログインページへの下線付きリンクを追加
- 認証チェック機能も同様に実装

### 解答例

```tsx
"use client";

import { useState, useEffect } from "react";
import { useRouter } from "next/navigation";
import Link from "next/link";
import { signUpAction } from "@/lib/actions";
import { createClient } from "@/lib/supabase/client";

export default function SignupPage() {
  const [error, setError] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [isCheckingAuth, setIsCheckingAuth] = useState(true);
  const router = useRouter();

  // ログイン状態をチェック
  useEffect(() => {
    const checkAuth = async () => {
      const supabase = createClient();
      const {
        data: { user },
      } = await supabase.auth.getUser();
      
      if (user) {
        // ログイン済みの場合はルートにリダイレクト
        router.push("/");
        return;
      }
      
      setIsCheckingAuth(false);
    };

    checkAuth();
  }, [router]);

  async function handleSignUp(formData: FormData) {
    setIsLoading(true);
    setError(null);

    try {
      const result = await signUpAction(formData);
      if (result) {
        setError(result.message);
      }
      // 成功時はServer Actionでredirectされるため、ここでは何もしない
    } catch (error) {
      setError("サインアップに失敗しました");
    } finally {
      setIsLoading(false);
    }
  }

  // 認証チェック中はローディング表示
  if (isCheckingAuth) {
    return (
      <div className="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 bg-gray-50">
        <div className="text-center">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
          <p className="mt-2 text-gray-600">認証状態を確認中...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 bg-gray-50">
      <div className="max-w-md w-full space-y-8 bg-white p-8 rounded-lg shadow-md">
        <div>
          <h2 className="mt-6 text-center text-3xl font-extrabold text-gray-900">
            新規アカウント作成
          </h2>
          <p className="mt-2 text-center text-sm text-gray-600">
            既にアカウントをお持ちの場合は
            <Link
              href="/login"
              className="font-medium text-blue-600 hover:text-blue-500 underline"
            >
              ログイン
            </Link>
            してください
          </p>
        </div>
        {error && (
          <div className="bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-md text-sm">
            {error}
          </div>
        )}

        <form className="mt-8 space-y-6" action={handleSignUp}>
          <div className="rounded-md shadow-sm -space-y-px">
            <div>
              <label htmlFor="email" className="sr-only">
                メールアドレス
              </label>
              <input
                id="email"
                name="email"
                type="email"
                autoComplete="email"
                required
                className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm"
                placeholder="メールアドレス"
              />
            </div>
            <div>
              <label htmlFor="password" className="sr-only">
                パスワード
              </label>
              <input
                id="password"
                name="password"
                type="password"
                autoComplete="new-password"
                required
                className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm"
                placeholder="パスワード（6文字以上）"
              />
            </div>
          </div>

          <div>
            <button
              type="submit"
              disabled={isLoading}
              className="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {isLoading ? "処理中..." : "アカウント作成"}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}
```

## 章末の確認

- 型定義が正しく作成されている
- Supabaseクライアントがサーバーサイドとクライアントサイドで動作する
- Server Actionsで認証処理が実行される
- エラーメッセージ管理システムが設定ファイルベースで動作する
- 日本語翻訳されたエラーメッセージが表示される
- Client Componentでのエラーハンドリングが適切に行われている
- ローディング状態とエラー状態のUIが正しく表示される
- ログインページで認証状態をチェックして自動リダイレクトされる
- ログインページでフォーム送信ができる
- サインアップページが独立して作成されている
- 各ページ間のナビゲーションリンクが正しく動作する
- ログイン済みユーザーがサインアップページにアクセスした際のリダイレクトが動作する
- 下線付きリンクが適切にスタイリングされている
- リンクのマージンが適切に設定されている
- サインアップページでフォーム送信ができる
- サインアップページで認証状態をチェックして自動リダイレクトされる
