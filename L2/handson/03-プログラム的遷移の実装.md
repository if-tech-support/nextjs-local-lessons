# 03-プログラム的遷移の実装

## はじめに

この章では、Next.jsの`next/navigation`の`useRouter`を使ってプログラム的遷移を実装します。ボタンクリックや条件分岐に応じて動的にページ遷移を行う機能を追加していきましょう。

## 目的

next/navigationのuseRouterでプログラム的遷移を体験する

## 学習対象のスキル

- `useRouter`フックの使用方法
- プログラム的遷移の実装
- 条件分岐による動的ナビゲーション

## 課題A：useRouterを使った戻るボタンの改善

（目安：15分）ヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

`src/app/users/[id]/BackButton.tsx`を編集し、以下の要件を満たしてください：

- `window.history.back()`の代わりに`useRouter`の`back()`メソッドを使用
- ボタンのテキストは「← ユーザ一覧に戻る」のまま
- ボタンのスタイルは青系の色で、ホバー時に少し暗くなる
- ユーザ詳細ページの上部に配置

### ヒント

- `next/navigation`から`useRouter`をインポート
- `useRouter()`フックでルーターインスタンスを取得
- `router.back()`メソッドで履歴を1つ戻る
- Tailwindクラス：`bg-blue-600`、`hover:bg-blue-700`、`text-white`、`px-4`、`py-2`

### 解答例

```tsx:src/app/users/[id]/BackButton.tsx
'use client';

import { useRouter } from 'next/navigation';

export default function BackButton() {
  const router = useRouter();

  const handleBack = () => {
    router.back();
  };

  return (
    <button
      onClick={handleBack}
      className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors duration-200 mb-4"
    >
      ← ユーザ一覧に戻る
    </button>
  );
}
```

### 実装ポイント

- `'use client'`ディレクティブが必要（useRouterを使用するため）
- `useRouter`フックでルーターインスタンスを取得
- `router.back()`でNext.jsのルーティングシステムを利用

## 課題B：ユーザ詳細ページへの戻るボタンの統合

（目安：10分）ヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

`src/app/users/[id]/page.tsx`を編集し、以下の要件を満たしてください：

- 既存のコードの先頭に`BackButton`コンポーネントをインポート
- ページタイトルの直前に戻るボタンを配置
- 戻るボタンとページタイトルの間に適切な余白を設定

### ヒント

- `BackButton`コンポーネントをインポート
- ページタイトルの直前に配置
- Tailwindクラス：`mb-6`で適切な余白を設定

### 解答例

```tsx:src/app/users/[id]/page.tsx
'use client';

import { useState, useEffect } from 'react';
import BackButton from './BackButton';

// ... existing code ...

export default function UserDetailPage({ params }: PageProps) {
  // ... existing code ...

  return (
    <div className="max-w-2xl mx-auto p-6">
      <BackButton />
      <h1 className="text-3xl font-bold mb-6">ユーザ詳細</h1>
      {/* ... existing code ... */}
    </div>
  );
}
```

### 実装ポイント

- 既存のコードを保持しながら、戻るボタンを適切な位置に配置
- コンポーネントのインポートと配置の順序を確認

## 課題C：条件分岐による動的遷移の実装

（目安：20分）ヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

`src/app/users/[id]/page.tsx`に以下の機能を追加してください：

- ユーザ詳細の下部に「ユーザ一覧に戻る」ボタンを追加
- このボタンは`useRouter`の`push()`メソッドを使用して`/users`ページに遷移
- ボタンのスタイルは緑系の色で、ホバー時に少し暗くなる
- 戻るボタンとユーザ詳細情報の間に配置

### ヒント

- `useRouter`の`push()`メソッドで特定のパスに遷移
- ボタンのスタイルは緑系の色を使用
- Tailwindクラス：`bg-green-600`、`hover:bg-green-700`、`text-white`、`px-4`、`py-2`

### 解答例

```tsx:src/app/users/[id]/page.tsx
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import BackButton from './BackButton';

// ... existing code ...

export default function UserDetailPage({ params }: PageProps) {
  const router = useRouter();
  // ... existing code ...

  const handleGoToList = () => {
    router.push('/users');
  };

  // ... existing code ...

  return (
    <div className="max-w-2xl mx-auto p-6">
      <BackButton />
      <h1 className="text-3xl font-bold mb-6">ユーザ詳細</h1>
      <div className="bg-white rounded-lg shadow-md p-6 space-y-4">
        {/* ... existing user details ... */}
      </div>
      
      <div className="mt-6 text-center">
        <button
          onClick={handleGoToList}
          className="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors duration-200 font-medium"
        >
          ユーザ一覧に戻る
        </button>
      </div>
    </div>
  );
}
```

### 実装ポイント

- `router.push('/users')`で特定のパスに直接遷移
- `router.back()`と`router.push()`の使い分けを理解
- ボタンの配置とスタイリングの一貫性を保つ

## 章末の確認

以下の手順で動作確認を行ってください：

1. 開発サーバーが起動していることを確認
```bash
npm run dev
```

2. ブラウザで`http://localhost:3000/users`にアクセス

3. 確認項目
- ユーザ一覧ページが表示される
- 任意のユーザ項目をクリックすると詳細ページに遷移する
- 詳細ページの上部に戻るボタン（← ユーザ一覧に戻る）が表示される
- 戻るボタンをクリックするとユーザ一覧ページに戻る
- 詳細ページの下部に「ユーザ一覧に戻る」ボタンが表示される
- 「ユーザ一覧に戻る」ボタンをクリックすると`/users`ページに直接遷移する
- 両方のボタンが適切に動作し、期待通りの遷移が行われる
