## はじめに

この章ではNext.jsの`next/navigation`を学びます。`useRouter`を使ったプログラム的遷移と、`notFound()`による404ハンドリングを学び、ナビゲーションAPIの基本的な使い分けの基盤を整えます。

## 目的

`next/navigation`の`useRouter`と`notFound()`で遷移と404ハンドリングを体験する。

## 学習対象のスキル

- `useRouter`フックの使用方法
- プログラム的遷移の実装
- 条件分岐による動的ナビゲーション
- `notFound()` による標準404ハンドリング
- `redirect()` による即時遷移

## 課題A：`useRouter` を使った戻るボタンの実装（15分）

15分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様
`src/app/users/[id]/BackButton.tsx` を作成/編集し、以下を満たしてください。

- 先頭に `"use client"` を記述しクライアントコンポーネントとする。
- `next/navigation` の `useRouter()` を用いクリック時に `router.back()` を実行する。
- ボタンはインラインフレックス（アイコン+テキスト）で両要素を縦中央揃え、アイコンとテキスト間隔8px。
- 余白：左右16px / 上下8px。
- アイコンは左向き矢印SVG（幅16px高さ16px）で文字色と同じ`currentColor`を利用する。
- 背景色は灰色600相当、ホバー時は灰色700相当へ変化、文字色は白、角丸約6px、色変化トランジションは0.15〜0.2秒。
- テキストは「戻る」。
- 追加の不要なラッパー要素や余計なテキストを挿入しない。

【使用タグ】
- `<button>` 最上位
  - `<svg>` アイコン
    - `<path>` 矢印形状
  - `<span>` テキスト

### ヒント

Tailwindの例：`inline-flex items-center space-x-2 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md transition-colors`

### 解答例

```tsx
"use client";

import { useRouter } from "next/navigation";

export default function BackButton() {
  const router = useRouter();

  return (
    <button
      onClick={() => router.back()}
      className="inline-flex items-center space-x-2 bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition-colors"
    >
      <svg
        className="w-4 h-4"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          strokeLinecap="round"
          strokeLinejoin="round"
          strokeWidth={2}
          d="M15 19l-7-7 7-7"
        />
      </svg>
      <span>戻る</span>
    </button>
  );
}
```

### 実装ポイント

- クリックハンドラーは短いので無名関数で直接記述する。
- アイコンは装飾のため`currentColor`指定で文字色と同期する。
- 視覚仕様は使用クラスに依存せず自然言語化して仕様内で固定している。

## 課題B：ユーザ詳細ページへの統合位置確認（10分）

10分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

`src/app/users/[id]/page.tsx` を編集し、以下を満たしてください。

- 戻るボタンラッパー（下余白約24px）をページ先頭に配置する。
- 見出し `<h1>` をボタン直後に配置し下余白約32px、テキスト「ユーザ詳細」。
- ボタンと見出し間に明確な間隔（約24px）を保つ。
- 詳細カードコンテナーは既存構造を維持し不要な追加ラッパーを増やさない。
- 戻るボタンを見出しより後ろへ移動しない。
- ユーザー取得に失敗した場合は `notFound()` を呼び出して標準の404ページへ委ねる（個別のエラーメッセージは表示しない）。

【使用タグ】
- `<div>` 最上位
  - `<div>` ボタンラッパー
  - `<h1>` 見出し
  - `<div>` 詳細カード

### ヒント

Tailwindの例：`mb-6`（ボタンラッパー）、`mb-8`（見出し）

### 解答例

```tsx
import { notFound } from "next/navigation";
import { User } from "@/types/user";
import BackButton from "./BackButton";

// 特定のユーザデータを取得する関数
async function getUser(id: string): Promise<User> {
  const response = await fetch(
    `https://jsonplaceholder.typicode.com/users/${id}`
  );

  if (!response.ok) {
    throw new Error("Failed to fetch user");
  }

  return response.json();
}

interface UserDetailPageProps {
  params: Promise<{
    id: string;
  }>;
}

export default async function UserDetailPage({ params }: UserDetailPageProps) {
  try {
    const { id } = await params;
    const user = await getUser(id);

    return (
      <div>
        <div className="mb-6">
          <BackButton />
        </div>

        <h1 className="text-3xl font-bold mb-8 text-gray-800">ユーザ詳細</h1>

        <div className="bg-white rounded-lg shadow-lg p-8 max-w-2xl">
          <div className="flex items-center space-x-6 mb-8">
            <div>
              <h2 className="text-2xl font-bold text-gray-800 mb-2">
                {user.username}
              </h2>
              <p className="text-gray-600">{user.name}</p>
            </div>
          </div>

          <div className="space-y-4">
            <div className="border-b pb-4">
              <h3 className="font-semibold text-gray-700 mb-2">連絡先情報</h3>
              <p className="text-gray-600">
                <span className="font-medium">メール:</span> {user.email}
              </p>
              <p className="text-gray-600">
                <span className="font-medium">電話:</span> {user.phone}
              </p>
              <p className="text-gray-600">
                <span className="font-medium">ウェブサイト:</span>{" "}
                <a
                  href={user.website}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="text-blue-600 hover:underline"
                >
                  {user.website}
                </a>
              </p>
            </div>

            <div className="border-b pb-4">
              <h3 className="font-semibold text-gray-700 mb-2">会社情報</h3>
              <p className="text-gray-600">
                <span className="font-medium">会社名:</span> {user.company.name}
              </p>
              <p className="text-gray-600">
                <span className="font-medium">キャッチフレーズ:</span>{" "}
                {user.company.catchPhrase}
              </p>
            </div>

            <div>
              <h3 className="font-semibold text-gray-700 mb-2">住所</h3>
              <p className="text-gray-600">
                {user.address.street}, {user.address.suite}
              </p>
              <p className="text-gray-600">
                {user.address.city}, {user.address.zipcode}
              </p>
            </div>
          </div>
        </div>
      </div>
    );
  } catch {
    notFound();
  }
}
```

### 実装ポイント

- サーバーコンポーネントであるためクライアントディレクティブは不要。
- BackButtonをラッパーごと分離し余白調整する。
- 見出し余白とボタン余白を差別化し上位階層を明示する。

## （参考）`router.back()` と `router.push()` の使い分け

本章では実装対象を履歴戻りに限定しています。任意の固定パスへ遷移したい場合は`router.push('/users')`のように明示パス指定が可能です。新しいUI要素を追加する際は既存仕様と整合する構造・視覚要件を先に自然言語で確定してください（この節に解答例コードはありません）。

## 課題C：トップページから一覧へ自動遷移する（5分）

5分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

- ファイルパス（編集）
  - `src/app/page.tsx`
- 要素構造と順序（親→子）
  - ページ関数の実行時に`/users`へ即時遷移する。UI要素は返さない。
- 具体数値・表現
  - なし（遷移のみ）。



### ヒント

Tailwindの例：該当なし

### 解答例

```tsx
// src/app/page.tsx
import { redirect } from 'next/navigation';

export default function HomePage() {
  redirect('/users');
}
```

## 章末の確認

以下の手順で動作確認を行ってください。

1. 開発サーバーを起動する。
```bash
npm run dev
```
2. トップページ（`http://localhost:3000/`）へアクセスすると`/users`に即時遷移する。
3. 一覧ページ（ユーザ一覧）で任意のユーザをクリックして詳細ページへ遷移する。
4. 詳細ページ先頭に戻るボタンが表示されている。
5. 戻るボタンと見出しの間隔が約24px、見出し下余白が約32pxである。
6. ボタンをホバーすると背景が一段階暗く変化する。
7. 戻るボタンを押すと直前のユーザ一覧へ戻る。
8. 戻った後ブラウザ戻るで再度詳細ページへ遷移し再度ボタンが機能する。
9. 存在しないIDに直接アクセスした場合、標準の404ページへ遷移する。
