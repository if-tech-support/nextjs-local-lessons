## はじめに

この章では、一覧テーブル（`MemoTable.tsx`）を作成し、`/memos`ページでフォームの下に配置して一覧表示を完成させます。

## 目的

- 横スクロール対応の一覧テーブルを作る。
- サーバーコンポーネントでメモ一覧を取得し（`cache: 'no-store'`）、テーブルに渡す。
- フォーム送信後の`router.refresh()`で一覧が更新されることを確認する。

## 学習対象のスキル

- テーブルマークアップ（thead/tbody/tr/th/td）。
- サーバーコンポーネントでの`fetch`とキャッシュ制御。
- 既存コンポーネントの統合（フォーム+テーブル）。

## 課題A：一覧テーブルを作る（15分）

15分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

- 要約: 横スクロール対応の4列テーブルを作成し、タイトルと操作列から詳細ページへ遷移できるようにする。
- 横スクロール対応ラッパー内に4列（タイトル／作成／更新／操作）のテーブルを置き、タイトルと操作に詳細ページへのリンクを付ける。
- ファイル:`src/app/memos/MemoTable.tsx`を作成。
- レイアウト:
  - ラッパーは横スクロール可能にする。
  - テーブルは横幅いっぱいで白い背景にする。
- ヘッダー: 4列（タイトル／作成／更新／操作）。
- 本文行: 各行のタイトルと操作に`/memos/[id]`へのリンクを付与。
- パディング: 各セルの内側余白は12px（Tailwind `p-3` 相当）。
- 日付: 日付表示の文字サイズは本文16pxより小さい14px（Tailwind `text-sm` 相当）。
- クラス換算根拠: `p-3`=12px, `text-sm`=14px（数値は仕様として固定）。
- 構造順序: `table`直下は`thead`→`tbody`→`tr`→`th`/`td`。

【使用タグ】
- `div`（ラッパー）
  - `table`
    - `thead`
      - `tr`
  - `th`×4（タイトル / 作成 / 更新 / 操作）
    - `tbody`
      - `tr`（複数行）
        - `td`×4（タイトル / 作成 / 更新 / 操作）

### ヒント

Tailwindの例：`overflow-x-auto` `w-full` `bg-white` `p-3` `text-sm`

### 解答例

```tsx
import Link from 'next/link';
import { Memo } from '@/types/memo';

export default function MemoTable({ memos }: { memos: Memo[] }) {
  return (
    <div className="overflow-x-auto">
      <table className="w-full bg-white">
        <thead>
          <tr>
            <th className="text-left p-3">タイトル</th>
            <th className="text-left p-3">作成</th>
            <th className="text-left p-3">更新</th>
            <th className="text-left p-3">操作</th>
          </tr>
        </thead>
        <tbody>
          {memos.map((m) => (
            <tr key={m.id}>
              <td className="p-3">
                <Link href={`/memos/${m.id}`} className="text-sky-700 underline hover:cursor-pointer">
                  {m.title}
                </Link>
              </td>
              <td className="p-3 text-sm text-sky-800">{new Date(m.created_at).toLocaleString()}</td>
              <td className="p-3 text-sm text-sky-800">{new Date(m.updated_at).toLocaleString()}</td>
              <td className="p-3">
                <Link href={`/memos/${m.id}`} className="text-sky-700 underline hover:cursor-pointer">
                  詳細
                </Link>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}

```

## 課題B：`/memos`にテーブルを配置して一覧を表示（15分）

15分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

- 要約: `/memos`ページで見出し→フォーム→テーブルの順に配置し、サーバーで一覧を取得してテーブルに渡す。
- ファイル:`src/app/memos/page.tsx`
- 見出し→フォーム→テーブルの順に配置する。
- サーバーコンポーネントでメモ一覧を取得する。`fetch`の`cache`は`no-store`。
- 見出し: 文字サイズ24px（Tailwind `text-2xl`）、太字、文字色 #0c4a6e（Tailwind `text-sky-900` 相当）。
- セクション間余白: 見出し/フォーム/テーブル間は縦方向32px（Tailwind `space-y-8` 相当）。
- テーブルセル余白: 12px（Tailwind `p-3` 相当）。
- 補助テキスト: 日付表示は14px（Tailwind `text-sm` 相当）。
- 取得失敗時: `res.ok`がfalseなら `throw new Error('Failed to fetch memos')` で例外化（結果として500相当エラー表示）。
- クラス換算根拠: `text-2xl`=約24px, `text-sm`=約14px, `p-3`=12px, `space-y-8`=32px（数値を仕様値として固定）。

【使用タグ】
- `div`（最上位）
  - `h1`
  - `section`（フォーム）
  - `section`（テーブル）

### ヒント

Tailwindの例：`space-y-8` `text-2xl` `font-bold` `text-sky-900`

- サーバーコンポーネントで`fetch`を実行する。
- `cache: 'no-store'`を指定する。
- エラー時は例外を投げる。
- 見出し→フォーム→テーブルの順で並べる。

### 解答例

```tsx
import { Memo } from '@/types/memo';
import { apiUrl } from '@/lib/api';
import NewMemoForm from './NewMemoForm';
import MemoTable from './MemoTable';

async function fetchMemos(): Promise<Memo[]> {
  const res = await fetch(apiUrl(`/api/memos`), { cache: 'no-store' });
  if (!res.ok) throw new Error('Failed to fetch memos');
  return res.json();
}

export default async function MemosPage() {
  const memos = await fetchMemos();
  return (
    <div className="space-y-8">
      <h1 className="text-2xl font-bold text-sky-900">メモ一覧</h1>
      <NewMemoForm />
      <section className="space-y-3">
        <MemoTable memos={memos} />
      </section>
    </div>
  );
}

```

## 章末の確認

- `/memos`にアクセスし、見出し→フォーム→テーブルの順で表示される。
- 新規作成後に一覧が即時更新される（`router.refresh()`が効いている）。
- テーブルのタイトル/詳細リンクから`/memos/[id]`へ遷移できる。
