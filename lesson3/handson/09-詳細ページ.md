## はじめに

詳細ページ（`/memos/[id]`）で1件のメモを表示できるようにします。存在しないIDは404として扱います。

## 目的

- `/memos/[id]`で詳細を表示できる。
- 404時に`notFound()`で分岐できる。

## 学習対象のスキル

- サーバーコンポーネントでの1件取得と404分岐。
- ページ内レイアウトの基本構成。

## 課題A：ページファイルの作成と見出し配置（10分）

10分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

詳細ページのファイルを作成し、ページ見出しだけを表示する最小構成を用意します。

- ファイルパス: `src/app/memos/[id]/page.tsx` を新規作成する。
- ページ最上位にコンテナーを置き、見出し「メモ詳細」を配置する。
- 見出しの文字サイズは約24px。
- コンテナー内の縦方向の間隔は約24px。
- 余計なラッパーを増やさない。

【使用タグ】
- `div` コンテナー
- `h1` ページ見出し

### ヒント

- 取得関数は`fetch(apiUrl(...), { cache: 'no-store' })`で都度取得する。
- `res.status === 404`のときは`null`を返す。それ以外で`!res.ok`は例外を投げる。
- ページでは`params`から`id`を受け取り、取得結果が`null`なら`notFound()`を返す。
- 取得関数の戻り値は`Promise<Memo | null>`とする。

### 解答例

```tsx
export default async function MemoDetail({ params }: { params: Promise<{ id: string }> }) {
  const { id } = await params;
  // idは後続課題で使用します。
  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold text-sky-900">メモ詳細</h1>
    </div>
  );
}

```

## 課題B：データ取得と404分岐の実装（10分）

10分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

IDでメモを取得し、存在しない場合は404を返す分岐を加えます。

- ファイルパス: `src/app/memos/[id]/page.tsx`。
- 1件取得関数を用意し、対象がなければ`null`を返す。
- ステータス404の場合は404として扱い、それ以外の不正はエラーにする。
- 詳細が存在しない場合は要素を描画せず、`notFound()`を返す。
- コンテナーや見出しのレイアウトは課題Aのまま。

【使用タグ】
- `div` コンテナー
- `h1` ページ見出し

### ヒント

Tailwindの例：`space-y-6` `text-2xl` `font-bold`

### 解答例

```tsx
import { Memo } from '@/types/memo';
import { apiUrl } from '@/lib/api';
import { notFound } from 'next/navigation';

async function fetchMemo(id: string): Promise<Memo | null> {
  const res = await fetch(apiUrl(`/api/memos/${id}`), { cache: 'no-store' });
  if (res.status === 404) return null;
  if (!res.ok) throw new Error('Failed to fetch memo');
  return res.json();
}

export default async function MemoDetail({ params }: { params: Promise<{ id: string }> }) {
  const { id } = await params;
  const memo = await fetchMemo(id);
  if (!memo) return notFound();
  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold text-sky-900">メモ詳細</h1>
    </div>
  );
}

```

## 課題C：詳細カードの表示（10分）

10分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様

取得したメモのタイトル・本文・日時をカードで表示します。

- ファイルパス: `src/app/memos/[id]/page.tsx`。
- 見出しの下にカードを配置する。
- カードの内側余白は約16px。
- 本文は改行を保持して表示する。
- 日時は作成と更新の2つを表示する。
- 余計なラッパーを増やさない。

【使用タグ】
- `div` カードラッパー
- `h2` タイトル
- `p` 本文
- `p` 日時

### ヒント

Tailwindの例：`p-4` `rounded` `text-xl` `whitespace-pre-wrap` `text-sm`

### 解答例

```tsx
import { Memo } from '@/types/memo';
import { apiUrl } from '@/lib/api';
import { notFound } from 'next/navigation';

async function fetchMemo(id: string): Promise<Memo | null> {
  const res = await fetch(apiUrl(`/api/memos/${id}`), { cache: 'no-store' });
  if (res.status === 404) return null;
  if (!res.ok) throw new Error('Failed to fetch memo');
  return res.json();
}

export default async function MemoDetail({ params }: { params: Promise<{ id: string }> }) {
  const { id } = await params;
  const memo = await fetchMemo(id);
  if (!memo) return notFound();
  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold text-sky-900">メモ詳細</h1>

      <div className="p-4 bg-white rounded">
        <h2 className="text-xl font-semibold text-sky-900">{memo.title}</h2>
        <p className="mt-2 whitespace-pre-wrap">{memo.content}</p>
        <p className="mt-3 text-sm text-sky-800">
          作成: {new Date(memo.created_at).toLocaleString()} / 更新: {new Date(memo.updated_at).toLocaleString()}
        </p>
      </div>
    </div>
  );
}

```

## 章末の確認

- 開発サーバーを起動し、一覧から任意のメモの「詳細」へ遷移する。

```bash
npm run dev
```

- `/memos/[id]`で次を確認する。
  - 見出し「メモ詳細」が表示される。
  - 取得したメモのタイトル/本文/作成・更新日時がカードに表示される。
  - 存在しないIDにアクセスすると404画面へ遷移する。
