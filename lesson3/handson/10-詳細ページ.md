## はじめに

詳細ページ（`/memos/[id]`）で1件のメモを表示できるようにします。存在しないIDは404として扱います。

## 目的

- `/memos/[id]`で詳細を表示できる。
- 404時に`notFound()`で分岐できる。

## 学習対象のスキル

- サーバーコンポーネントでの1件取得と404分岐。
- ページ内レイアウトの基本構成。

## 課題A：ページファイルの作成と見出し配置（10分）

10分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様
1件詳細ページの骨格として、最上位コンテナー直下に見出し1要素のみを配置して表示する。

- 対象ファイル: `src/app/memos/[id]/page.tsx`（新規作成）。
- 構造: 最上位`div`直下に`h1`を1つだけ配置する。
- 見出し文言: `メモ詳細`。
- 見出し文字サイズ: 24px。
- 見出し文字色: #0c4a6e。
- 縦方向の要素間隔基盤: 24pxの縦余白設定（現時点では見出しのみだが後続追加用の余白を確保）。
- コンテナー役割: 章後半でカード等を追加できる余白ベースを用意する。
- 余計なラッパー禁止: 最上位`div`と`h1`以外の要素は追加しない。
- 関数形式: `export default async function MemoDetail({ params }: { params: Promise<{ id: string }> })` とし `const { id } = await params;` で値を取り出す（課題Aでは `id` は未使用）。
- `id` の利用は後続課題で実装する。

【使用タグ】
- `div`（最上位コンテナー）
  - `h1`（ページ見出し）

### ヒント

- 取得関数は`fetch(apiUrl(...), { cache: 'no-store' })`で都度取得する。
- `res.status === 404`のときは`null`を返す。それ以外で`!res.ok`は例外を投げる。
- ページでは`params`から`id`を受け取り、取得結果が`null`なら`notFound()`を返す。
- 取得関数の戻り値は`Promise<Memo | null>`とする。

Tailwindの例：`space-y-6` `text-2xl` `font-bold`

### 解答例

```tsx
export default async function MemoDetail({ params }: { params: Promise<{ id: string }> }) {
  // const { id } = await params; // 課題Aでは未使用（後続課題で利用）
  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold text-sky-900">メモ詳細</h1>
    </div>
  );
}
```

## 課題B：データ取得と404分岐の実装（10分）

10分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様
IDで1件取得し存在しない場合は404へ分岐する処理を追加する。

- 対象ファイル: `src/app/memos/[id]/page.tsx`（課題Aの同一ファイルを編集）。
- 追加関数: `async function fetchMemo(id: string): Promise<Memo | null>` を定義する。
- データ取得: `fetch(apiUrl(`/api/memos/${id}`), { cache: 'no-store' })` を用いて常に最新を取得する。
- 404判定: `res.status === 404` のとき `null` を返す。
- 異常系: 上記以外で `!res.ok` の場合は `throw new Error('Failed to fetch memo')` を投げる。
- 戻り値型: 正常時は `Memo` オブジェクト、存在しない場合は `null`。
- ページ側処理: `const { id } = await params;` で取得し `fetchMemo(id)` → `null` の場合は即 `notFound()` を実行し描画を中断。
- レイアウト/HTML構造/見出し/クラス付与は課題Aと同一（追加要素はまだ置かない）。
- 不要変更禁止: 課題Aで定義した見出し文言・クラスを変更しない。
- 余計なラッパーや空要素を新設しない。

【使用タグ】
- `div`（最上位コンテナー）
  - `h1`（ページ見出し）

### ヒント

- `fetchMemo`関数を実装し、`404`は`null`、それ以外の`!ok`で例外を投げる。
- ページコンポーネントで`params.id`を取得する。
- 取得結果が`null`の場合は即`notFound()`を呼び出す。
- `fetchMemo`の戻り値型は`Promise<Memo | null>`。
- レイアウトと見出し構造は課題Aと同じ。

### 解答例

```tsx
import { Memo } from '@/types/memo';
import { apiUrl } from '@/lib/api';
import { notFound } from 'next/navigation';

async function fetchMemo(id: string): Promise<Memo | null> {
  const res = await fetch(apiUrl(`/api/memos/${id}`), { cache: 'no-store' });
  if (res.status === 404) return null;
  if (!res.ok) throw new Error('Failed to fetch memo');
  return res.json();
}

export default async function MemoDetail({ params }: { params: Promise<{ id: string }> }) {
  const { id } = await params;
  const memo = await fetchMemo(id);
  if (!memo) return notFound();
  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold text-sky-900">メモ詳細</h1>
    </div>
  );
}
```

## 課題C：詳細カードの表示（10分）

10分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。

### 仕様
取得済みメモの内容を白背景・角丸4px・内側余白16pxのカードコンテナー内で表示する。

- 対象ファイル: `src/app/memos/[id]/page.tsx`（課題Bの同一ファイルを編集）。
- 追加要素構造: 見出し直下に詳細カード`div`を1つ追加し、その内部に `h2`（タイトル）→`p`（本文）→`p`（作成/更新日時）をこの順序で配置する。
- カード内側余白: 16px。
- カード背景色: #ffffff。
- カード角丸: 4px。
- タイトル文字サイズ: 20px。
- タイトル文字色: #0c4a6e。
- 本文表示: 改行を保持（CSS `white-space: pre-wrap`）。
- 本文とタイトルの間隔: 上マージン8px。
- 日時行の間隔: 本文下に上マージン12px。
- 日時行書式: `作成: <ローカル日時> / 更新: <ローカル日時>` とし `toLocaleString()` を利用。
- 日時文字サイズ: 14px。文字色: #075985。
- 利用フィールド: `memo.title` / `memo.content` / `memo.created_at` / `memo.updated_at`。
- 既存の404分岐と取得ロジック: 課題Bの実装を保持し変更しない。
- 余計なラッパー禁止: 追加はカード`div`のみ。

【使用タグ】
- `div`（最上位コンテナー）
  - `h1`（ページ見出し）
  - `div`（詳細カード）
    - `h2`（タイトル）
    - `p`（本文：改行保持）
    - `p`（作成/更新日時）

### ヒント

Tailwindの例：`p-4` `rounded` `text-xl` `whitespace-pre-wrap` `text-sm`

### 解答例

```tsx
import { Memo } from '@/types/memo';
import { apiUrl } from '@/lib/api';
import { notFound } from 'next/navigation';

async function fetchMemo(id: string): Promise<Memo | null> {
  const res = await fetch(apiUrl(`/api/memos/${id}`), { cache: 'no-store' });
  if (res.status === 404) return null;
  if (!res.ok) throw new Error('Failed to fetch memo');
  return res.json();
}

export default async function MemoDetail({ params }: { params: Promise<{ id: string }> }) {
  const { id } = await params;
  const memo = await fetchMemo(id);
  if (!memo) return notFound();
  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold text-sky-900">メモ詳細</h1>
      <div className="p-4 bg-white rounded">
        <h2 className="text-xl font-semibold text-sky-900">{memo.title}</h2>
        <p className="mt-2 whitespace-pre-wrap">{memo.content}</p>
        <p className="mt-3 text-sm text-sky-800">
          作成: {new Date(memo.created_at).toLocaleString()} / 更新: {new Date(memo.updated_at).toLocaleString()}
        </p>
      </div>
    </div>
  );
}
```

## 章末の確認

次の手順で表示と404分岐を確認します。

```bash
npm run dev
```

1. 一覧ページ（`/memos`）から任意のレコードの「詳細」リンクをクリック。
2. `/memos/[id]`ページで以下を確認。
  - 見出し`メモ詳細`が表示される。
  - 白背景・角丸・余白付きカードが表示される。
  - カード内にタイトル/本文（改行保持）/「作成: ... / 更新: ...」が表示される。
3. 存在しないID（例：`/memos/xxxxxxxx`）へ直接アクセスし404ページへ遷移することを確認。

期待される結果（要点）:
- ページ構造が仕様通り（最上位 `div.space-y-6` 内に `h1` と詳細カードのみ）。
- 取得失敗（404）時に`notFound()`が発火しNext.jsの404表示になる。
- 本文の改行が `white-space: pre-wrap` で保持されている。
