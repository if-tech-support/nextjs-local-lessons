# contents.md生成用プロンプト（パラメーター不要・自己抽出モード）

あなたは教材コンテンツ編集者です。レッスンフォルダー内の実ファイルから必要情報を自動抽出し、レッスンの「contents.md」を日本語で作成してください。出力はMarkdownのみで、指定の見出し構成とスタイルに厳密にしたがってください。

［対象レッスンの特定ルール］
- このプロンプトを実行する直前に編集中/アクティブなレッスンフォルダー（例: `lesson1`/`lesson2`/`lesson3`）を対象とする。
- もし複数候補がある場合は、ユーザーの編集中ディレクトリにもっとも近い`lessonN`を対象とする。
- 学習者は題材アプリの完成形やリポジトリ全体構造を知らない前提。`contents.md`本文で「完成形」「最終コードとの差分」等の作成者向け言及を行わない。

［入力ソース（自動抽出）］
- 必須: `<lesson>/handson/design.md`
- 任意: `<lesson>/handson/*.md`（各章）、`<lesson>/README.md`、`<lesson>/src/**`、`<lesson>/package.json`、`<lesson>/next.config.*`、`<lesson>/postcss.config.*`

［抽出手順］
1) lesson_title
   - 基本は`<lesson>/README.md`の先頭見出しや概要から抽出。
   - なければ`design.md`のタイトルや要約から簡潔に命名（例: "Lesson N: <要約キーワード>"）。
2) overview
   - `design.md`の冒頭要約/ゴール説明から1〜2文で要約。
3) stack
   - `package.json`の依存、`next.config.*`、`postcss.config.*`、`src/**`の使用から推定（例: Next.js/React/Tailwind CSS/Supabase）。
4) target_audience
   - `design.md`の対象者や前提から抽出。なければ想定を2〜4行で補完（初中級者向けなど）。
5) goals
   - `design.md`の目的・学習ゴールから3〜6項目を抽出。
6) skills
   - 実装で触れるAPI/概念を`design.md`と`src/**`から抽出（例: Route Handler/NextRequest/NextResponse/DBクライアント）。
7) prerequisites
   - `design.md`やREADMEから環境条件を抽出（Node.js LTS等）。
8) pages_or_routes
   - `src/app/**`のディレクトリ/ファイルから主要ページ/ルートを列挙（例: `/memos`, `/memos/[id]`, `GET /api/memos`等）。
9) special_rules
   - `design.md`やREADMEにある実装ルール（例: サーバーアクション不使用/クラスは最大N個）を列挙。
10) db_section_enabled/db_vendor/db_project_naming_guidelines
   - DB利用有無を`src/**`や依存から判定（例: `@supabase/*`があればtrue/ベンダー名=Supabase）。
   - 命名方針は`design.md`のガイドがあれば抽出、なければ最小限を補完。
11) env_vars
   - `.env`例やREADME/コード中の参照（`process.env.*`や`NEXT_PUBLIC_*`）から列挙。
12) chapters
   - `<lesson>/handson`配下の`NN-*.md`を番号順に走査し、`no`/`filename`/`synopsis`を作成。
   - synopsisは各章の冒頭「はじめに」「目的」から1行で要約。ない場合はファイル名から自然に補完。

［コード一致（Strict Parity）簡易検査補足］
- `chapters`列挙後、次のフィールドに依存する章（例: メモ一覧/詳細など）が存在する場合は、`src/app/**`実コードから実際のタグ階層/関数名/表示文字列を読み取り、`pages_or_routes`や`skills`へ反映する。
- 差分が疑われる場合（例: `contents.md`生成候補で列挙したパスが実際に存在しない / 実コードにある主要ページが列挙漏れ）は、出力内に直接エラーメッセージを埋め込まず、正しい抽出結果のみを出力（欠落/誤りを自動的に補正）。
- 参照優先度: 実コード > design.md > README。実コードで確認できない事項のみ上位ファイルで補完。
- 同一パスの重複は1回に統合し、順序はパスの階層昇順（ページ→API）。

［任意のパラメーター上書き］
- もし呼び出し時に明示的パラメーター（lesson_title等）が与えられた場合は、自動抽出結果よりもそれらを優先して使用してよい。

［出力要件］
- ドキュメントはMarkdown。先頭から次の見出し順で構成すること。
  1) 「## はじめに」
     - overviewと、完成形や範囲を箇条書きで簡潔に示す
  2) 「## 対象者」
     - target_audienceを箇条書き
  3) 「## 目的」
     - goalsを番号付きリスト
  4) 「## 学習対象のスキル」
     - skillsを箇条書き
  5) 「## 前提（推奨）」
     - prerequisitesを箇条書き
     - db_section_enabled=trueなら、db_vendorの新規作成が必要である旨と、db_project_naming_guidelinesを小見出しや箇条書きで追加
  6) 任意ブロック
     - env_varsがあれば「環境変数（.env）例：」として箇条書き
     - pages_or_routesがあれば適切な場所で簡潔に触れる
     - special_rulesがあれば注意点として列挙
  7) 区切り線（---）
  8) 「## 章立て（目次）」
     - chapters配列を番号順に並べ、各項目を
       - 「n. `filename`」の行
       - 次行で「- synopsis」を1行
       - 章の後に「各章のMarkdownは、次の見出しルールで統一されています。」を置き、以下を箇条書きで示す:
          - 章タイトルは不要（先頭はH2から）。
          - 本文のH2は「はじめに」「目的」「学習対象のスキル」「課題A/B/C」「章末の確認」に限定する（その他のH2は置かない）。
          - 見出し構成の雛形（例：はじめに／目的／学習対象のスキル／課題群／章末の確認）。
          - タイプAの各課題見出し直下には導入定型文「X分ほどヒントを参考にして仕様どおりにコーディングに挑戦し、その後に解答例で確認しましょう。」を厳密一致で記載（Xは見出しの分数と一致）。
          - 仕様セクションは、冒頭に1文の要約→番号なし箇条書き（`-`）で「ファイルパス/構成/具体数値/制約」を具体的な項目名で記述する（抽象ラベルの使用は不可）。
          - 「【使用タグ】」は仕様本文の直後に空行を挟んだ独立ブロックとして置き、タグ名は親→子の階層がわかる入れ子のハイフン箇条書きで列挙。「完了条件」「ヒント」などは混在させない）。
          - API章の「章末の確認」では、curlコマンドに`-i`を付けHTTPステータスとレスポンスヘッダーも確認できるようにする。
          - UI課題の仕様本文では、次のようなラベル付き箇条書きのグルーピング（例:「構造:」「入力要素の属性:」「スタイル:」「振る舞い:」）を1つずつハイフン行として並べ、その下に入れ子の詳細箇条書きを置く形式も許容する（見出しではなく通常の箇条書きラベルであること）。
            - UI+振る舞い/UI+API混在課題では、以下の共通テンプレート順序（または下記ラベルの一部省略）を推奨する。各行は見出しではなく1つのハイフン箇条書きとし、必要なら下位入れ子で詳細を記述する。
               - 対象ファイル:
               - 構造:
                  -（タグ階層・並び）
               - 入力要素の属性:
               - スタイル:
               - 振る舞い（今回実装分）:
               - 送信先:（API課題時）
               - リクエスト仕様:（API課題時、method / headers / body）
               - エラー処理:（API課題時）
               - 成功時処理:（API課題時）
               - 最終処理:（API課題時 / finallyで行うもの）
               - 除外（今回未実装）:（次章以降で扱う項目を明示的に列挙する任意枠）
            - 上記テンプレのラベル語尾にコロンを付ける（例:「構造:」）。ラベルそのものをH3等の見出しに昇格させない。
  9) 区切り線（---）
  10) 「## 進め方と検証方針」
      - 実行と検証の流れを箇条書きで3〜5項目
  11) 「## 注意」
      - 実装上の制約やセキュリティ/鍵管理などの注意点を箇条書きで2〜5項目

［文体・スタイル］
- 簡潔で一貫した日本語。教材として自然で読みやすい文。
- 原則として全角文字と半角文字の間にスペースを入れない。
- 読みやすさを優先し、ひらがなが適切な語（例：わかるなど）はひらがなを用いる。
- 専門用語やファイル名やコードはインラインコード（`code`）を使う。
- 追加方針（簡潔表現モード）: synopsisやゴール行は40文字以内を推奨し、必要最小語のみ。
- 箇条書き末尾の句点は省略可（再現性に影響ない場合）。
- 主語や助詞を省略しても意味が一意なら許容（例:「GETで一覧取得」）。

［禁止事項］
- 出力前後の私的コメントや断り書きは不要。指定の構成のみを出力。
- 架空のコマンド実行例は記載しない（必要時は名称のみに留める）。

［注意事項（自己抽出モード特有）］
- 参照できる実ファイルのみから抽出し、推測は最小限に留める。推測した場合は自然な日本語に整形する。
- 章ファイルが存在しない番号は飛ばさず、存在する`NN-*.md`のみを列挙する。
- 章数は固定しない。
- 出力前後に私的コメントを付与しない。指定の構成のみを出力。

この条件で、対象レッスンのcontents.mdを生成してください。
