# contents.md生成用プロンプト（パラメーター不要・自己抽出モード）

あなたは教材コンテンツ編集者です。レッスンフォルダー内の実ファイルから必要情報を自動抽出し、レッスンの「contents.md」を日本語で作成してください。出力はMarkdownのみで、指定の見出し構成/順序/文体/フォーマット規則に厳密に従います。以下の規則は再現性と機械的適用性を高めるため曖昧さを極力排除しています。

［対象レッスンの特定ルール］
- このプロンプト実行直前に編集中/アクティブなレッスンフォルダー（例: `lesson1`/`lesson2`/`lesson3`）を対象とする。
- 複数候補がある場合は編集中ディレクトリにもっとも近い`lessonN`を採用。
- 学習者は題材アプリ全体像を知らない前提。本文で「最終コードとの差分」等の語を使用しない（代替語：「到達する機能範囲」）。"完成形" は冒頭でゴール境界明示目的の1回使用を許容（例: "完成形は次の条件を満たす"）。
- ビルド生成物（`.next/`等）や既存`contents.md`は抽出ソースとして利用しない。

［入力ソース（自動抽出）］
- 必須: `<lesson>/handson/design.md`（存在しない場合は以下のフォールバック順で最初に見つかったものをdesignソースとみなす：`<lesson>/README.md`→最初の章ファイル→コードコメント→なし）
- 任意: `<lesson>/handson/*.md`（各章）、`<lesson>/README.md`、`<lesson>/src/**`、`<lesson>/package.json`、`<lesson>/next.config.*`、`<lesson>/postcss.config.*`
- 無視: `.next/`配下、`node_modules/`配下、`handson/contents.md`（循環参照防止）

［抽出手順（優先度: 実コード > designソース > README > 他章 > 推測最小限）］
1) lesson_title
   - `<lesson>/README.md`先頭H1または冒頭要約。
   - 無ければdesignソースのタイトル/要約。
   - どちらも無ければ`Lesson N: <主要キーワード>`形式（主要キーワード=stackまたはもっとも代表的なドメイン名詞1語）。
2) overview
   - designソース冒頭ゴール/要約1〜2文。無ければ章1冒頭から抽出。
3) stack
   - 抽出順序固定: Framework→Language→Styling→Data/Backend→Auth→Tooling/Build。
   - `package.json`依存/設定ファイル/コードインポートから列挙。重複とバージョンは除去し名称のみ。
4) target_audience
   - designソースの対象者/前提。無ければ: 初中級のNext.js学習者/React基礎理解/基本的なHTML/CSS/JS経験。
5) goals
   - designソースの学習ゴール3〜6項目。3未満ならskills上位概念を昇格して補完（最大で3に充足）。成果表現中心（例：「API経由でCRUD実装」）。
6) skills
   - コード上で利用される概念/API（例: RouteHandler、NextRequest、NextResponse、fetch、ServerComponents、DBクライアント）。goalsと重複語はskillsに含めつつgoalsはよりアウトカム指向に再表現。
7) prerequisites
   - Node.js LTS推奨、パッケージマネージャー、Git基本操作などdesignソース/READMEから。重複削除。
8) pages_or_routes
   - `src/app/**`からページ（`page.tsx`/`layout.tsx`）とAPIルート（`route.ts`）を検出。
   - 表記形式統一: ページは`/path`、動的は`/path/[param]`、APIは`GET /api/foo`のようにメソッド+スペース+パス（複数メソッドは別行）。
   - ソート順: 1. ページ（階層昇順 → 静的 → 動的）2. API（パス昇順 → メソッドアルファベット昇順）。
9) special_rules
   - 使用禁止/推奨/命名/構成指針（例: サーバーアクション未使用、ファイル分割基準、型定義分離）。
10) db_section_enabled / db_vendor / db_project_naming_guidelines
   - 判定: `@supabase/`→Supabase, `prisma`依存か、`schema.prisma`→Prisma、`schema.sql`のみ→RDB（名称推測しない）。ツール検出なければfalse。
   - 命名指針例（ない場合の補完最小案）:「テーブル名は複数形スネークケース」「カラムは英小文字スネークケース」「外部キーは `<単数形>_id`」。
11) env_vars
   - `process.env.` / `NEXT_PUBLIC_` / `.env`ファイルからキーのみ列挙（値/例示値は記載しない）。重複・危険キー除外。
12) chapters
   - `NN-*.md` のNN昇順。
   - 出力標準フォーマット: 番号付きリスト `n. \`filename\`` 次行インデント（半角スペース2〜3推奨）で `- 概要文` 1行。
   - 概要文は章の学習/実装焦点を1文で要約（40文字制限撤廃。冗長回避し60文字程度目安）。
   - 抽出優先: 章冒頭→「はじめに」節→「目的」節→最初の本文段落。抽出不能時は主要名詞再構成。
   - 旧フォーマット（ペア: 見出し行 + 次行 `- synopsis`）も許容するが混在不可。
   - 時間表記 `(15分)` 等は概要文に含めない。

［コード一致（Strict Parity）補足］
- 章内で参照されたページ/APIが`src/app/**`に存在しない場合は列挙から除外（エラー出力不可）。
- コード側に存在し章で未言及の主要ページ/CRUD APIは自動追加。
- タグ階層/主要表示テキスト/関数名が章記述と乖離する場合はコード側に合わせ補正。
- 優先度: 実コード > designソース > README > 章ファイル > 補完。
- 重複パスは統合し前述ソート規則を適用。

［任意パラメーター上書き］
- 呼び出し時に明示的パラメーター（lesson_title等）が与えられた場合は抽出結果より優先。

［出力要件］
- ドキュメントはMarkdown。見出しH1禁止（常に「## はじめに」開始）。「## 章立て（目次）」は必須。他は該当データ無ければ省略。
1) 「## はじめに」:overview1〜2文+（任意）"完成形は"1文+技術/構成/思想箇条書き1〜6
2) 「## 対象者」:箇条書き
3) 「## 目的」:goals番号付き
4) 「## 学習対象のスキル」:skills箇条書き
5) 「## 前提（推奨）」:prerequisites箇条書き+DB利用補足（H3禁止、段落+箇条書き）
6) 任意ブロック（存在順）:「主要ページ/ルート:」→「実装ルール:」→「環境変数」（キーのみ;例示値はローカルURL等非秘匿のみ括弧可）。
7) `---`
8) 「## 章立て（目次）」：番号リスト + 概要。直後に固定文 + 見出しルール箇条書き。
9) `---`
10) 「## 進め方と検証方針」: 3〜5項目
11) 「## 注意」: 2〜5項目（実装ルール重複回避）

［文体・スタイル］
- 簡潔で一貫した日本語（敬体回避）。
- 英数字前後スペース不要（衝突時のみ挿入）。
- コード/パス/環境変数はインラインコード。
- goals 40文字制限撤廃。章概要は~60文字以内目安。
- 箇条書き末尾句点なし（必要時のみ）。
- H2中心。H3は課題内部（仕様/ヒント/解答例）に限定。
- 「【使用タグ】」ブロック例:

   【使用タグ】
   - section
      - h1
      - p
      - ul
         - li


［禁止事項］
- 出力前後の私的コメント/断り書き。
- 架空またはコードに存在しないパス/API/環境変数/コマンド。
- 値を伴う環境変数例（キーのみ）。
- データが存在しない空節の出力（指定された必須節除く）。
- 「完成形」「最終コード」など学習者視点で未確定な語。

［注意事項（自己抽出モード特有）］
- 実ファイルのみを根拠とし推測は不足補完最小限。
- 章ファイルは存在する`NN-*.md`のみ列挙（欠番は無視）。
- 章数は可変。
- 既存 `handson/contents.md` を入力ソースに利用しない。
- Strict Parity補正は静かに適用し誤記を出力に残さない。
- 要素が0件の任意ブロックは完全に省略。

以上の仕様に従い対象レッスンの `contents.md` を生成すること。
